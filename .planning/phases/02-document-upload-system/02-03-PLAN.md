---
phase: 02-document-upload-system
plan: 03
type: execute
---

<objective>
Create document list and upload UI components for the wallet feature.

Purpose: Provide user-facing components that display documents and enable upload workflow.
Output: Reusable DocumentList and DocumentUploadSheet components in wallet feature.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-document-upload-system/02-RESEARCH.md

**Prior plans in this phase:**
@.planning/phases/02-document-upload-system/02-01-SUMMARY.md
@.planning/phases/02-document-upload-system/02-02-SUMMARY.md

**Existing code:**
@src/features/wallet/types.ts
@src/features/wallet/hooks/index.ts
@src/theme/index.ts

**Established UI patterns:**
- React Native Paper components for UI
- Feature-based component organization
- useTheme() hook for styling
- FlashList for long lists (@shopify/flash-list)

**From Plan 02-02:**
- useDocumentPicker hook
- useDocumentUpload hook
- Store selector hooks (usePersonalDocuments, etc.)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DocumentListItem and DocumentList components</name>
  <files>src/features/wallet/components/DocumentListItem.tsx, src/features/wallet/components/DocumentList.tsx</files>
  <action>
Create `src/features/wallet/components/DocumentListItem.tsx`:

1. Props interface:
   ```typescript
   interface DocumentListItemProps {
     document: WalletDocument;
     onPress: (document: WalletDocument) => void;
     onDelete?: (document: WalletDocument) => void;
   }
   ```

2. Display:
   - Document icon based on mimeType (PDF icon vs image thumbnail)
   - Document name (truncated if long)
   - Document type badge (passport, visa, booking, etc.)
   - File size formatted (KB/MB)
   - Upload date
   - Swipeable delete action (optional)

3. Use React Native Paper components:
   - List.Item for base layout
   - IconButton for actions
   - Chip for document type badge

Create `src/features/wallet/components/DocumentList.tsx`:

1. Props interface:
   ```typescript
   interface DocumentListProps {
     documents: WalletDocument[];
     loading?: boolean;
     onDocumentPress: (document: WalletDocument) => void;
     onRefresh?: () => void;
     emptyMessage?: string;
     ListHeaderComponent?: React.ReactElement;
   }
   ```

2. Implementation:
   - Use FlashList for performance (not FlatList)
   - estimatedItemSize: 80 (approximate row height)
   - Show loading indicator when loading
   - Pull-to-refresh with onRefresh
   - Empty state with message when no documents
   - Render DocumentListItem for each document

3. Performance:
   - Memoize item renderer with useCallback
   - Use keyExtractor with document.id

**Do NOT:**
- Use FlatList (use FlashList for performance)
- Inline styles (use StyleSheet or theme)
- Skip empty state handling
  </action>
  <verify>
Run type check: `npx tsc --noEmit src/features/wallet/components/DocumentListItem.tsx src/features/wallet/components/DocumentList.tsx 2>&1 | head -30`
  </verify>
  <done>
- DocumentListItem displays document info with icon, name, type badge
- DocumentList uses FlashList with proper performance optimizations
- Loading and empty states handled
- Pull-to-refresh support
- No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DocumentUploadSheet component and export all</name>
  <files>src/features/wallet/components/DocumentUploadSheet.tsx, src/features/wallet/components/index.ts</files>
  <action>
Create `src/features/wallet/components/DocumentUploadSheet.tsx`:

1. Props interface:
   ```typescript
   interface DocumentUploadSheetProps {
     visible: boolean;
     onDismiss: () => void;
     walletType: WalletType;
     tripId?: string; // Required if walletType is 'group'
     onUploadComplete?: (document: WalletDocument) => void;
   }
   ```

2. Implementation:
   - Use React Native Paper Modal or Portal for sheet
   - Three source options: Camera, Gallery, Files
   - Document type selector (dropdown with DocumentType values)
   - Name input field
   - Optional description field
   - Upload button with progress indicator

3. Upload flow:
   - Use useDocumentPicker hook for file selection
   - Use useDocumentUpload hook for upload
   - Show progress bar during upload
   - Show error message on failure
   - Call onUploadComplete and onDismiss on success

4. Form state:
   ```typescript
   const [selectedFile, setSelectedFile] = useState<PickedFile | null>(null);
   const [documentType, setDocumentType] = useState<DocumentType>('other');
   const [name, setName] = useState('');
   const [description, setDescription] = useState('');
   ```

5. Validation:
   - File must be selected
   - Name must not be empty
   - tripId required if walletType is 'group'

Update `src/features/wallet/components/index.ts`:
- Export DocumentListItem
- Export DocumentList
- Export DocumentUploadSheet

**Do NOT:**
- Handle upload logic in component (use hooks)
- Skip form validation
- Forget to clear form state after successful upload
- Allow group upload without tripId
  </action>
  <verify>
Run type check: `npx tsc --noEmit src/features/wallet/components/*.tsx 2>&1 | head -30`
  </verify>
  <done>
- DocumentUploadSheet provides full upload flow UI
- Three source options (camera, gallery, files)
- Document type and metadata form
- Progress indicator during upload
- Error handling and display
- Form validation in place
- components/index.ts exports all components
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Document upload flow: picker services, store integration, and UI components</what-built>
  <how-to-verify>
1. Start the app: `npm start` then press `a` for Android or `i` for iOS
2. Navigate to where wallet components would be used (may need temporary test screen)
3. Test document picker:
   - Verify image picker opens gallery
   - Verify document picker shows file browser
   - Verify camera option opens camera
4. Test upload flow (requires Supabase setup):
   - If Supabase is configured with migrations applied:
     - Pick an image and upload
     - Verify compression happens (file size reduced)
     - Verify upload completes with progress
   - If Supabase not configured:
     - Verify picker and form work
     - Upload will fail gracefully with error message
5. Verify components render without crashes
  </how-to-verify>
  <resume-signal>Type "approved" if components work, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes for all component files
- [ ] Components follow existing UI patterns (React Native Paper, theme)
- [ ] FlashList used for DocumentList (not FlatList)
- [ ] Upload flow uses hooks from Plan 02-02
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>

- DocumentListItem component displays document info
- DocumentList component with FlashList, loading, empty state
- DocumentUploadSheet with source selection, form, progress
- All components exported from components/index.ts
- No TypeScript errors
- Human verified: components render and basic flow works
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-document-upload-system/02-03-SUMMARY.md` following summary.md template.

This is the final plan for Phase 2. Summary should include:
- All components created
- Integration with hooks verified
- Human verification results
- Phase 2 complete, ready for Phase 3 (Personal Wallet - Travel Docs)
</output>
